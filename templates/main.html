{% extends "layout.html" %}
{% block head %}
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.3.0/socket.io.dev.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.0.11/handlebars.min.js"></script>
    <!-- <script type="text/javascript" src="{{url_for('static', filename='js/main.js')}}"></script> -->
    <script id="waitlist" type="text/x-handlebars-template">
    <h3>Jugadores:</h3>
    <div id="teamA">
        <h4>Equipo A:</h4>
        <ul>
        {% raw -%}
            {{#each teamAPlayers}}
                <li>{{this}}</li>
            {{/each}}
        {%- endraw %}
        </ul>
    </div>
    <div id="teamB">
        <h4>Equipo B:</h4>
        <ul>
        {% raw -%}
            {{#each teamBPlayers}}
                <li>{{this}}</li>
            {{/each}}
        {%- endraw %}
        </ul>
    </div>
   </script>
    <script id='game_full' type="text/x-handlebars-template">
        <h3>El juego est√° lleno</h3>
    </script>
    <script id='game' type="text/x-handlebars-template">
        <h3>Tu mano:</h3>
        <ul>
            {% raw -%}
            {{#each hand}}
                <li id='card{{@index}}'>{{this[0]}} de {{this[1]}}</li>
            {{/each}}
            {%- endraw %}
        </ul>
        <ul id="cards_played">

        </ul>
    </script>
    <script type="text/javascript">
        const templateWait = Handlebars.compile(document.querySelector('#waitlist').innerHTML);
        const templateFull = Handlebars.compile(document.querySelector('#game_full').innerHTML);
        const templateGame = Handlebars.compile(document.querySelector('#game').innerHTML);
        var inGame = false;
        var playerData;
        var hand;
        document.addEventListener('DOMContentLoaded', () => {
            var socket = io.connect(location.protocol + '//' + document.domain + ':' + location.port);
            socket.on('players_update', data => {
                teamAPlayers = [data.teams.teamA.player1.username, data.temas.teamA.player2.username];
                teamBPlayers = [data.teams.teamB.player1.username, data.temas.teamB.player2.username];
                const content = templateWait({teamAPlayers, teamBPlayers});
                document.querySelector('#body').innerHTML = content;
                if (inGame) {
                    const buttonOut = document.createElement("button");
                    buttonOut.innerHTML = 'Salir';
                    buttonOut.onclick = () => {
                        socket.emit('player_left', playerData );
                    };
                    document.querySelector('#teamB').appendChild(buttonOut);
                } else {
                    if (!(data.teams.teamA.full))  {
                        const buttonA = document.createElement("button");
                        buttonA.innerHTML = 'Entrar';
                        buttonA.onclick = () => {
                            socket.emit('player_enter', {team:'teamA'});
                        }
                        document.querySelector('#teamA').appendChild(buttonA);
                    };
                    if (!(data.teams.teamB.full))  {
                        const buttonB = document.createElement("button");
                        buttonB.innerHTML = 'Entrar';
                        buttonB.onclick = () => {
                            socket.emit('player_enter', {team:'teamB'});
                        };
                        document.querySelector('#teamB').appendChild(buttonB);
                    };
                }
            });

            socket.on('player_data', data =>    {
                inGame = true;
                playerData = data;
            });

            socket.on('game_full',() => {
                const content = templateFull();
                document.querySelector('#body').innerHTML = content;
            });

            socket.on('game_starts', data =>    {
                hand = data.team[playerData.team][playerData.player].hand
                const content = templateGame({'hand':hand});
                document.querySelector('#body').innerHTML = content;

            });
        });
    </script>
{% endblock %}
{% block cuerpo%}
    <div id='body'>
    </div>
{% endblock %}
